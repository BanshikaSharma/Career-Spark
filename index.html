<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Student Counseling System
  </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
   body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        #reportContent {
            max-height: 220px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', Courier, monospace;
        }
        /* Custom scrollbar for report */
        #reportContent::-webkit-scrollbar {
            width: 8px;
        }
        #reportContent::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 4px;
        }
        #reportContent::-webkit-scrollbar-thumb {
            background: #764ba2;
            border-radius: 4px;
        }
  </style>
 </head>
 <body class="min-h-screen flex items-center justify-center p-6">
  <div class="relative bg-white bg-opacity-90 backdrop-blur-md p-10 rounded-3xl shadow-2xl w-full max-w-lg border border-purple-300" id="mainContainer">
   <h1 aria-atomic="true" aria-live="polite" class="text-4xl font-extrabold text-center mb-10 text-purple-800 drop-shadow-lg" id="appTitle">
    Career Spark
   </h1>
   <form class="mb-8 space-y-6" id="signupForm" novalidate="">
    <div>
     <label class="block text-purple-700 font-semibold mb-1" for="signupName">
      Name
     </label>
     <input aria-label="Name" aria-required="true" class="w-full p-4 border border-purple-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition" id="signupName" placeholder="Your full name" required="" type="text"/>
    </div>
    <div>
     <label class="block text-purple-700 font-semibold mb-1" for="signupEmail">
      Email
     </label>
     <input aria-label="Email" aria-required="true" class="w-full p-4 border border-purple-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition" id="signupEmail" placeholder="you@example.com" required="" type="email"/>
    </div>
    <div>
     <label class="block text-purple-700 font-semibold mb-1" for="signupPassword">
      Password
     </label>
     <input aria-label="Password" aria-required="true" class="w-full p-4 border border-purple-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition" id="signupPassword" placeholder="Create a password" required="" type="password"/>
    </div>
    <div class="text-center text-sm font-semibold mt-2" id="signupMessage" role="alert">
    </div>
    <button aria-label="Sign Up" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:from-purple-700 hover:to-indigo-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-400" id="signupButton" type="button">
     <i class="fas fa-user-plus mr-3">
     </i>
     Sign Up
    </button>
    <p class="text-center text-purple-600">
     Already have an account?
     <a class="font-semibold hover:underline" href="#" id="switchToLogin">
      Login here
     </a>
    </p>
   </form>
   <form class="mb-8 space-y-6 hidden" id="loginForm" novalidate="">
    <div>
     <label class="block text-green-700 font-semibold mb-1" for="loginEmail">
      Email
     </label>
     <input aria-label="Email" aria-required="true" class="w-full p-4 border border-green-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 focus:border-green-600 transition" id="loginEmail" placeholder="you@example.com" required="" type="email"/>
    </div>
    <div>
     <label class="block text-green-700 font-semibold mb-1" for="loginPassword">
      Password
     </label>
     <input aria-label="Password" aria-required="true" class="w-full p-4 border border-green-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-green-400 focus:border-green-600 transition" id="loginPassword" placeholder="Your password" required="" type="password"/>
    </div>
    <div class="text-center text-sm font-semibold mt-2 text-green-700" id="loginMessage" role="alert">
    </div>
    <button aria-label="Login" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:from-green-700 hover:to-emerald-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-400" id="loginButton" type="button">
     <i class="fas fa-sign-in-alt mr-3">
     </i>
     Login
    </button>
    <p class="text-center text-green-600">
     Don't have an account?
     <a class="font-semibold hover:underline" href="#" id="switchToSignup">
      Sign up here
     </a>
    </p>
   </form>
   <div class="mb-8 hidden" id="startButton">
    <button aria-label="Start Quiz" class="w-full bg-gradient-to-r from-purple-700 to-indigo-700 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:from-purple-800 hover:to-indigo-800 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-400" id="quizStartButton" type="button">
     <i class="fas fa-play mr-3">
     </i>
     Start Quiz
    </button>
   </div>
   <section aria-atomic="true" aria-live="polite" aria-relevant="additions removals" class="hidden" id="questionSection">
    <div aria-atomic="true" aria-live="polite" class="mb-2 text-center text-purple-700 font-semibold text-lg" id="questionCount">
     Question 1/30
    </div>
    <div class="mb-6 text-gray-900 text-xl font-bold drop-shadow-sm" id="questionContainer">
    </div>
    <form class="space-y-6" id="answerForm">
     <div class="flex flex-col sm:flex-row sm:justify-center sm:space-x-12 space-y-4 sm:space-y-0">
      <label class="flex items-center space-x-3 cursor-pointer rounded-xl border-2 border-purple-300 p-4 hover:border-purple-600 transition focus-within:ring-4 focus-within:ring-purple-400">
       <input aria-label="Yes" class="form-radio text-purple-600 w-6 h-6" name="response" type="radio" value="Yes"/>
       <span class="text-lg font-semibold text-purple-700 select-none">
        Yes
       </span>
      </label>
      <label class="flex items-center space-x-3 cursor-pointer rounded-xl border-2 border-purple-300 p-4 hover:border-purple-600 transition focus-within:ring-4 focus-within:ring-purple-400">
       <input aria-label="No" class="form-radio text-purple-600 w-6 h-6" name="response" type="radio" value="No"/>
       <span class="text-lg font-semibold text-purple-700 select-none">
        No
       </span>
      </label>
     </div>
     <div>
      <label class="block text-purple-700 font-semibold mb-1" for="reasonInput">
       Please provide a reason for your answer*
      </label>
      <textarea aria-label="Reason for your answer" class="w-full p-4 border border-purple-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition resize-none" id="reasonInput" name="reason" placeholder="Type your reason here..." rows="3"></textarea>
     </div>
    </form>
    <div class="flex justify-between mt-10">
     <button aria-label="Previous Question" class="flex items-center space-x-2 bg-gray-300 text-gray-800 py-3 px-7 rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed shadow-md hover:bg-gray-400 transition duration-300 focus:outline-none focus:ring-4 focus:ring-gray-400" disabled="" id="prevButton" type="button">
      <i class="fas fa-arrow-left">
      </i>
      <span>
       Previous
      </span>
     </button>
     <button aria-label="Next Question" class="flex items-center space-x-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-7 rounded-xl font-semibold shadow-lg hover:from-purple-700 hover:to-indigo-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-400" id="nextButton" type="button">
      <span>
       Next
      </span>
      <i class="fas fa-arrow-right">
      </i>
     </button>
    </div>
   </section>
   <section aria-atomic="true" aria-live="polite" class="hidden mt-10" id="reportSection">
    <h2 class="text-2xl font-extrabold mb-6 text-center text-purple-900 drop-shadow-md">
     Your Personality Report
    </h2>
    <pre class="bg-purple-50 p-6 rounded-2xl max-h-56 overflow-y-auto whitespace-pre-wrap text-purple-900 font-mono text-base shadow-inner border border-purple-300" id="reportContent"></pre>
    <button aria-label="Download Report" class="w-full mt-8 bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:from-green-700 hover:to-emerald-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-emerald-400" id="downloadReport" type="button">
     <i class="fas fa-download mr-3">
     </i>
     Download Report
    </button>
    <button aria-label="View Graph" class="w-full mt-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-xl font-semibold text-lg shadow-lg hover:from-indigo-700 hover:to-purple-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-purple-400" id="viewGraphButton" type="button">
     <i class="fas fa-chart-bar mr-3">
     </i>
     View Graph
    </button>
   </section>
  </div>
  <div class="hidden min-h-screen flex flex-col items-center justify-center p-6 bg-white bg-opacity-90 backdrop-blur-md rounded-3xl shadow-2xl w-full max-w-4xl border border-purple-300 relative" id="graphPage">
   <h1 class="text-4xl font-extrabold mb-10 text-purple-800 drop-shadow-lg relative z-10">
    Career Spark - Response Chart
   </h1>
   <canvas aria-label="Bar chart showing yes and no responses by category" class="max-w-full" height="400" id="responseChart" role="img" width="800">
   </canvas>
   <button aria-label="Back to Report" class="mt-10 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 px-10 rounded-xl font-semibold text-lg shadow-lg hover:from-purple-700 hover:to-indigo-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-400 relative z-10" id="backToReport">
    <i class="fas fa-arrow-left mr-3">
    </i>
    Back to Report
   </button>
   <img alt="Large faint watermark text 'Career Spark' in light gray behind content" aria-hidden="true" class="pointer-events-none absolute inset-0 m-auto w-96 h-96 opacity-20 select-none" height="600" src="https://storage.googleapis.com/a1aa/image/faa2c27f-7118-42e7-4f34-580104c78e27.jpg" width="600"/>
  </div>
  <script>
   const signupButton = document.getElementById('signupButton');
        const loginButton = document.getElementById('loginButton');
        const quizStartButton = document.getElementById('quizStartButton');
        const reportSection = document.getElementById('reportSection');
        const reportContent = document.getElementById('reportContent');
        const downloadReport = document.getElementById('downloadReport');
        const appTitle = document.getElementById('appTitle');
        const signupForm = document.getElementById('signupForm');
        const loginForm = document.getElementById('loginForm');
        const startButton = document.getElementById('startButton');
        const questionSection = document.getElementById('questionSection');
        const questionContainer = document.getElementById('questionContainer');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const answerForm = document.getElementById('answerForm');
        const switchToLogin = document.getElementById('switchToLogin');
        const switchToSignup = document.getElementById('switchToSignup');
        const reasonInput = document.getElementById('reasonInput');
        const signupMessage = document.getElementById('signupMessage');
        const loginMessage = document.getElementById('loginMessage');
        const questionCount = document.getElementById('questionCount');
        const viewGraphButton = document.getElementById('viewGraphButton');
        const graphPage = document.getElementById('graphPage');
        const mainContainer = document.getElementById('mainContainer');
        const backToReport = document.getElementById('backToReport');

        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentUser  = null;

        let selectedQuestions = [];
        let currentQuestionIndex = 0;
        let responses = [];
        const categoryCounts = {};

        function selectRandomQuestions() {
            const shuffled = [             { "Category": "Applied Arts", "Question": "Do you enjoy creating original artwork or crafts?" },
            { "Category": "Applied Arts", "Question": "Do you often experiment with different design tools or media?" },
            { "Category": "Applied Arts", "Question": "Are you interested in learning art techniques professionally?" },
            { "Category": "Technology", "Question": "Do you enjoy solving technical problems?" },
            { "Category": "Technology", "Question": "Are you interested in programming or software development?" },
            {"Category": "Applied Arts","Question": "Would you like to pursue a career in visual design, sculpture, or illustration?"},
            {"Category": "Applied Arts","Question": "Do you often feel inspired by visual surroundings?"},
 {
  "Category": "Applied Arts",
  "Question": "Would you enjoy a job that involves crafting or painting daily?"
 },
 {
  "Category": "Applied Arts",
  "Question": "Do you enjoy working with colors and visual textures?"
 },
 {
  "Category": "Applied Arts",
  "Question": "Are you good at drawing or visualizing objects in 3D?"
 },
 {
  "Category": "Applied Arts",
  "Question": "Would you like to work in galleries or creative studios?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Are you comfortable handling business operations?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Do you enjoy analyzing sales and market data?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Would you enjoy managing a team to meet business goals?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Are you interested in organizational behavior and management strategy?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Do you find it fulfilling to improve business efficiency?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Do you like negotiating or closing business deals?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Do you enjoy making strategic decisions for growth?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Would you enjoy leading a business unit or company?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Do you stay updated on business trends and markets?"
 },
 {
  "Category": "Commerce & Management",
  "Question": "Are you interested in entrepreneurship or corporate leadership?"
 },
 {
  "Category": "Defense Services",
  "Question": "Are you physically fit and enjoy discipline?"
 },
 {
  "Category": "Defense Services",
  "Question": "Do you feel motivated by the idea of serving your country?"
 },
 {
  "Category": "Defense Services",
  "Question": "Can you handle high-pressure situations calmly?"
 },
 {
  "Category": "Defense Services",
  "Question": "Do you prefer structured, team-based environments?"
 },
 {
  "Category": "Defense Services",
  "Question": "Are you open to relocating or working in remote locations?"
 },
 {
  "Category": "Defense Services",
  "Question": "Are you willing to undergo intense physical and mental training?"
 },
 {
  "Category": "Defense Services",
  "Question": "Do you value discipline and chain-of-command roles?"
 },
 {
  "Category": "Defense Services",
  "Question": "Are you interested in a career in military or security services?"
 },
 {
  "Category": "Defense Services",
  "Question": "Would you enjoy survival training or tactical simulations?"
 },
 {
  "Category": "Defense Services",
  "Question": "Do you admire leadership and bravery in action?"
 },
 {
  "Category": "Design",
  "Question": "Do you enjoy sketching or planning design ideas?"
 },
 {
  "Category": "Design",
  "Question": "Are you fascinated by user interface (UI) or product design?"
 },
 {
  "Category": "Design",
  "Question": "Do you pay attention to colors, typography, and layout?"
 },
 {
  "Category": "Design",
  "Question": "Have you used any digital design tools (e.g., Figma, Photoshop)?"
 },
 {
  "Category": "Design",
  "Question": "Do you want to design experiences that solve real-world problems?"
 },
 {
  "Category": "Design",
  "Question": "Do you enjoy brainstorming creative solutions to visual problems?"
 },
 {
  "Category": "Design",
  "Question": "Do you notice design flaws in everyday products or spaces?"
 },
 {
  "Category": "Design",
  "Question": "Would you like to design logos, ads, or websites?"
 },
 {
  "Category": "Design",
  "Question": "Are you drawn to interior, fashion, or industrial design?"
 },
 {
  "Category": "Design",
  "Question": "Do you follow design trends or famous designers?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Are you good at planning the movement of goods?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Do you enjoy working with schedules and efficiency tracking?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Are you interested in supply chain or warehouse systems?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Do you handle logistical or shipping challenges well?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Do you enjoy roles with operational coordination?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Do you like streamlining systems and reducing delays?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Are you good at keeping things organized and timely?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Would you enjoy managing warehouses or fleets?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Are you skilled at analyzing shipping or routing data?"
 },
 {
  "Category": "Distribution & Logistics",
  "Question": "Do you enjoy optimizing delivery systems or schedules?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Do you like teaching or mentoring others?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Are you patient and empathetic with people?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Are you interested in social work or development programs?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Do you enjoy helping others grow or learn?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Would you enjoy a role where you make a direct social impact?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Do you feel fulfilled helping someone understand a concept?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Would you enjoy working in community service or outreach?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Do you care about improving education access?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Would you like to work with children, youth, or adults?"
 },
 {
  "Category": "Education Training & Social Services",
  "Question": "Do you enjoy creating lesson plans or training content?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Do you enjoy solving engineering or technical problems?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Are you interested in software or hardware development?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Do you like learning how systems work?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Have you ever built a robot, coded an app, or repaired a gadget?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Would you enjoy designing or optimizing technical systems?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Do you enjoy figuring out how devices or software work?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Would you enjoy building machines, apps, or systems from scratch?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Do you keep up with new technologies or innovations?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Are you interested in AI, robotics, or automation?"
 },
 {
  "Category": "Engineering, Information & Technology",
  "Question": "Would you enjoy working as an engineer or IT specialist?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Do you prefer creating your own projects over following others'?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Are you comfortable taking business risks?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Do you see problems as opportunities to create new solutions?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Are you naturally curious and proactive?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Would you enjoy building a team to bring your ideas to life?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Do you often think of new business ideas?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Do you enjoy managing all aspects of a project or business?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Do you enjoy pitching ideas or products to others?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Would you like to start your own company?"
 },
 {
  "Category": "Entrepreneurship",
  "Question": "Are you self-motivated and driven by innovation?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Are you comfortable with numbers and calculations?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Do you enjoy working with budgets and spreadsheets?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Are you detail-oriented and precise with data?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Are you interested in investments, stocks, or taxes?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Would you enjoy managing a company's financial records?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Do you find budgeting satisfying?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Would you enjoy auditing or reviewing financial data?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Are you good at reconciling accounts and spotting errors?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Do you stay updated with financial news and trends?"
 },
 {
  "Category": "Finance & Accounting",
  "Question": "Would you like to work as a financial analyst or accountant?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Are you interested in how governments and organizations function?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Do you enjoy creating or enforcing policies?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Are you good at organizing and coordinating tasks?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Do you like public affairs, law, or civic responsibility?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Would you like to contribute to the public sector?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Do you enjoy organizing large events or teams?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Would you like to influence policy or public operations?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Are you interested in administrative leadership roles?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Do you like analyzing policies or governance systems?"
 },
 {
  "Category": "Governance & Administration",
  "Question": "Would you enjoy working in civil services or public administration?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Are you interested in biology, health, or anatomy?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Do you enjoy caring for others' health and well-being?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Would you be comfortable in clinical or hospital environments?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Are you passionate about fitness and physical wellness?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Would you like to pursue a role in healthcare or medical sciences?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Are you interested in becoming a doctor, nurse, or therapist?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Do you enjoy helping people recover or stay healthy?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Do you care about nutrition and lifestyle choices?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Would you enjoy working in a hospital or clinic?"
 },
 {
  "Category": "Health, Medicine & Fitness",
  "Question": "Do you like staying updated with health science research?"
 },
 {
  "Category": "Hospitality",
  "Question": "Do you enjoy making people feel welcome and comfortable?"
 },
 {
  "Category": "Hospitality",
  "Question": "Are you good at handling guest services and requests?"
 },
 {
  "Category": "Hospitality",
  "Question": "Would you enjoy working in hotels, events, or travel?"
 },
 {
  "Category": "Hospitality",
  "Question": "Are you calm and patient in customer-facing roles?"
 },
 {
  "Category": "Hospitality",
  "Question": "Do you enjoy organizing dining, stays, or experiences?"
 },
 {
  "Category": "Hospitality",
  "Question": "Do you enjoy fast-paced service environments?"
 },
 {
  "Category": "Hospitality",
  "Question": "Are you skilled at managing customer expectations?"
 },
 {
  "Category": "Hospitality",
  "Question": "Would you like to run or manage a hospitality business?"
 },
 {
  "Category": "Hospitality",
  "Question": "Do you like creating memorable experiences for others?"
 },
 {
  "Category": "Hospitality",
  "Question": "Are you interested in event planning or tourism?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Are you very skilled at mathematics and statistics?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Do you enjoy working with data and predictive modeling?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Are you detail-oriented when working with numbers?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Would you enjoy assessing risk for insurance or finance?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Are you interested in probability and financial forecasting?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Do you enjoy analyzing complex data for patterns?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Would you like to help companies make data-driven decisions?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Are you interested in risk analysis and financial planning?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Do you like solving quantitative problems with accuracy?"
 },
 {
  "Category": "Actuarial Sciences",
  "Question": "Would you enjoy working as an actuary or data scientist?"
 },
 {
  "Category": "Legal",
  "Question": "Are you interested in laws, justice, or legal systems?"
 },
 {
  "Category": "Legal",
  "Question": "Do you enjoy reading and interpreting rules and regulations?"
 },
 {
  "Category": "Legal",
  "Question": "Can you argue your point logically and clearly?"
 },
 {
  "Category": "Legal",
  "Question": "Would you enjoy advocating for others in legal matters?"
 },
 {
  "Category": "Legal",
  "Question": "Are you passionate about fairness and ethics?"
 },
 {
  "Category": "Legal",
  "Question": "Do you enjoy reading and analyzing complex texts?"
 },
 {
  "Category": "Legal",
  "Question": "Would you like representing others in legal situations?"
 },
 {
  "Category": "Legal",
  "Question": "Are you interested in legal writing or research?"
 },
 {
  "Category": "Legal",
  "Question": "Would you enjoy working in courts or law firms?"
 },
 {
  "Category": "Legal",
  "Question": "Are you intrigued by legal debates and social justice?"
 },
 {
  "Category": "Marketing",
  "Question": "Do you enjoy promoting ideas or products?"
 },
 {
  "Category": "Marketing",
  "Question": "Are you good at understanding customer behavior?"
 },
 {
  "Category": "Marketing",
  "Question": "Do you like creating content that influences people?"
 },
 {
  "Category": "Marketing",
  "Question": "Are you familiar with branding, campaigns, or digital media?"
 },
 {
  "Category": "Marketing",
  "Question": "Would you enjoy analyzing trends to improve outreach?"
 },
 {
  "Category": "Marketing",
  "Question": "Are you good at crafting persuasive messages?"
 },
 {
  "Category": "Marketing",
  "Question": "Do you enjoy figuring out what makes people buy things?"
 },
 {
  "Category": "Marketing",
  "Question": "Would you like to lead brand strategy or marketing teams?"
 },
 {
  "Category": "Marketing",
  "Question": "Are you interested in social media or advertising trends?"
 },
 {
  "Category": "Marketing",
  "Question": "Do you enjoy measuring the effectiveness of campaigns?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Are you comfortable speaking or writing in public?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Do you enjoy creating content for media platforms?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Are you interested in journalism, PR, or broadcasting?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Do you enjoy storytelling and engaging with audiences?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Would you enjoy using media to share news or ideas?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Do you enjoy crafting stories or messages for different audiences?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Are you curious about the impact of social and digital media?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Would you like to work in TV, radio, or publishing?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Are you interested in visual and digital storytelling?"
 },
 {
  "Category": "Media & Communication",
  "Question": "Do you enjoy interviews, documentaries, or podcasting?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Do you enjoy singing, dancing, or acting?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Are you confident performing in front of others?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Do you practice a performing art in your free time?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Would you like to perform professionally or as a career?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Are you passionate about theater, music, or dance?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Do you express yourself through movement or performance?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Would you enjoy turning emotions into performance pieces?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Do you like performing in front of an audience?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Are you interested in stagecraft or directing?"
 },
 {
  "Category": "Performing Arts",
  "Question": "Do you enjoy rehearsing and perfecting a routine?"
 },
 {
  "Category": "Sales",
  "Question": "Do you enjoy convincing others about a product or idea?"
 },
 {
  "Category": "Sales",
  "Question": "Are you confident in communication and negotiation?"
 },
 {
  "Category": "Sales",
  "Question": "Do you enjoy reaching targets and closing deals?"
 },
 {
  "Category": "Sales",
  "Question": "Are you persistent even when hearing 'no'?"
 },
 {
  "Category": "Sales",
  "Question": "Would you enjoy a competitive, commission-based role?"
 },
 {
  "Category": "Sales",
  "Question": "Do you enjoy meeting new people and introducing them to products?"
 },
 {
  "Category": "Sales",
  "Question": "Are you driven by targets and performance-based rewards?"
 },
 {
  "Category": "Sales",
  "Question": "Would you like to work in retail, real estate, or tech sales?"
 },
 {
  "Category": "Sales",
  "Question": "Are you comfortable working under pressure?"
 },
 {
  "Category": "Sales",
  "Question": "Do you enjoy learning about products and customer needs?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Are you curious about how things work scientifically?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Do you enjoy solving logical or numerical problems?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Are you interested in physics, chemistry, or math?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Do you like conducting experiments or calculations?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Would you enjoy researching scientific phenomena?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Do you enjoy formulating hypotheses and testing them?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Are you naturally curious about scientific explanations?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Would you like to work in labs, observatories, or research?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Do you enjoy writing scientific papers or findings?"
 },
 {
  "Category": "Science & Maths",
  "Question": "Are you excited by new scientific discoveries?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Are you curious about human behavior and society?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Do you enjoy reading about history, culture, or psychology?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Would you like to explore sociology, politics, or economics?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Are you interested in human rights, ethics, or philosophy?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Do you enjoy thinking critically about people and systems?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Do you enjoy debating social or ethical topics?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Would you like studying different cultures and their influence?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Are you interested in public policy, education, or development?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Would you enjoy working as a researcher or analyst?"
 },
 {
  "Category": "Social Sciences & Humanities",
  "Question": "Are you interested in how people think, feel, and act?"
 }

      
 ].sort(() => 0.5 - Math.random());
            selectedQuestions = shuffled.slice(0, 1);
        }

        function showMessage(message, isError = true, targetElement = null) {
            if (!targetElement) {
                alert(message);
                return;
            }
            targetElement.textContent = message;
            if (isError) {
                targetElement.classList.remove('text-green-700');
                targetElement.classList.add('text-red-600');
            } else {
                targetElement.classList.remove('text-red-600');
                targetElement.classList.add('text-green-700');
            }
        }

        function showQuestion() {
            const currentQuestion = selectedQuestions[currentQuestionIndex];
            questionContainer.textContent = currentQuestion.Question; 
            answerForm.response.value = ""; 
            reasonInput.value = ""; 
        }

        signupButton.addEventListener('click', function () {
            signupMessage.textContent = '';
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!name) {
                showMessage('Please enter your name.', true, signupMessage);
                return;
            }
            if (!email) {
                showMessage('Please enter your email.', true, signupMessage);
                return;
            }
            if (!password) {
                showMessage('Please enter your password.', true, signupMessage);
                return;
            }

            const existingUser   = users.find(u => u.email.toLowerCase() === email.toLowerCase());
            if (existingUser  ) {
                showMessage('Email already exists. Please go to the login page and login.', true, signupMessage);
                signupForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                return;
            }

            users.push({ name, email, password });
            localStorage.setItem('users', JSON.stringify(users));
            showMessage('Signup successful! You can now log in.', false, signupMessage);
            signupForm.reset();
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        loginButton.addEventListener('click', function () {
            loginMessage.textContent = '';
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email) {
                showMessage('Please enter your email.', true, loginMessage);
                return;
            }
            if (!password) {
                showMessage('Please enter your password.', true, loginMessage);
                return;
            }

            const user = users.find(user => user.email.toLowerCase() === email.toLowerCase() && user.password === password);
            if (user) {
                currentUser   = user;
                loginForm.reset();
                loginForm.classList.add('hidden');
                startButton.classList.remove('hidden');
                appTitle.textContent = `Welcome, ${user.name}`;
                loginMessage.textContent = '';
            } else {
                showMessage('Email not found or password incorrect. Please sign up.', true, loginMessage);
                loginForm.reset();
                loginForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            }
        });

        switchToLogin.addEventListener('click', function (event) {
            event.preventDefault();
            signupMessage.textContent = '';
            loginMessage.textContent = '';
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        switchToSignup.addEventListener('click', function (event) {
            event.preventDefault();
            signupMessage.textContent = '';
            loginMessage.textContent = '';
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
        });

        quizStartButton.addEventListener('click', function () {
            selectRandomQuestions();
            startButton.classList.add('hidden');
            questionSection.classList.remove('hidden');
            currentQuestionIndex = 0;
            responses = [];
            for (const key in categoryCounts) {
                delete categoryCounts[key];
            }
            updateAppTitle();
            showQuestion();
            prevButton.disabled = true;
            nextButton.disabled = false;
        });

        prevButton.addEventListener('click', function () {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                updateAppTitle();
                showQuestion();
                if (responses[currentQuestionIndex]) {
                    answerForm.response.value = responses[currentQuestionIndex].answer;
                    reasonInput.value = responses[currentQuestionIndex].reason;
                } else {
                    answerForm.response.value = "";
                    reasonInput.value = "";
                }
            }
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.disabled = false;
        });

        nextButton.addEventListener('click', function () {
            const userResponse = answerForm.response.value;
            const reason = reasonInput.value.trim();

            if (!userResponse) {
                alert('Please select an answer.');
                return;
            }
            if (!reason) {
                alert('Please provide a reason for your answer.');
                return;
            }

            const currentCategory = selectedQuestions[currentQuestionIndex].Category;

            if (responses[currentQuestionIndex]) {
                const prevAnswer = responses[currentQuestionIndex].answer;
                if (prevAnswer === "Yes") {
                    categoryCounts[currentCategory].yes--;
                } else {
                    categoryCounts[currentCategory].no--;
                }
            }

            if (!categoryCounts[currentCategory]) {
                categoryCounts[currentCategory] = { yes: 0, no: 0 };
            }
            if (userResponse === "Yes") {
                categoryCounts[currentCategory].yes++;
            } else {
                categoryCounts[currentCategory].no++;
            }

            responses[currentQuestionIndex] = {
                question: selectedQuestions[currentQuestionIndex].Question,
                answer: userResponse,
                reason: reason
            };

            currentQuestionIndex++;

            if (currentQuestionIndex < selectedQuestions.length) {
                updateAppTitle();
                showQuestion();
                if (responses[currentQuestionIndex]) {
                    answerForm.response.value = responses[currentQuestionIndex].answer;
                    reasonInput.value = responses[currentQuestionIndex].reason;
                } else {
                    answerForm.response.value = "";
                    reasonInput.value = "";
                }
            } else {
                generateReport();
                appTitle.textContent = `Thank you, ${currentUser.name}`;
                questionCount.textContent = '';
                questionSection.classList.add('hidden');
                reportSection.classList.remove('hidden');
            }

            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.disabled = currentQuestionIndex >= selectedQuestions.length;
        });

        function updateAppTitle() {
            appTitle.textContent = `Question ${currentQuestionIndex + 1}/${selectedQuestions.length} - Welcome, ${currentUser.name}`;
            questionCount.textContent = `Question ${currentQuestionIndex + 1}/${selectedQuestions.length}`;
        }

        function generatePersonalityRemarks(responses) {
            let yesCount = responses.reduce((acc, cur) => acc + (cur.answer === "Yes" ? 1 : 0), 0);
            let personality = "";
            if (yesCount >= 25) {
                personality = "You have a highly positive and proactive personality, showing great enthusiasm and openness.";
            } else if (yesCount >= 18) {
                personality = "You have a balanced personality with a good mix of positivity and caution.";
            } else if (yesCount >= 10) {
                personality = "You tend to be more cautious and reserved, preferring stability and routine.";
            } else {
                personality = "You have a very reserved and introspective personality, valuing careful thought and reflection.";
            }
            return personality;
        }

        function getProminentCategory() {
            let maxYes = 0;
            let prominentCategory = '';
            for (const category in categoryCounts) {
                if (categoryCounts[category].yes > maxYes) {
                    maxYes = categoryCounts[category].yes;
                    prominentCategory = category;
                }
            }
            return prominentCategory;
        }

        function generateReport() {
            let reportText = `Personality Report for ${currentUser.name}\n\n`;
            responses.forEach((response, index) => {
                reportText += `Q${index + 1}: ${response.question}\nAnswer: ${response.answer}\nReason: ${response.reason}\n\n`;
            });
            const remarks = generatePersonalityRemarks(responses);
            const prominentCategory = getProminentCategory();
            reportText += `--- Personality Remarks:\n${remarks}\n\nMost Prominent Category: ${prominentCategory}`;
            reportContent.textContent = reportText;
        }

        function drawGraph() {
            const ctx = document.getElementById('responseChart').getContext('2d');
            if (window.responseChartInstance) {
                window.responseChartInstance.destroy();
            }
            const labels = Object.keys(categoryCounts);
            const yesCounts = labels.map(label => categoryCounts[label].yes);
            const noCounts = labels.map(label => categoryCounts[label].no);

            window.responseChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Yes Responses',
                            data: yesCounts,
                            backgroundColor: 'rgba(255, 192, 192, 0.6)',
                        },
                        {
                            label: 'No Responses',
                            data: noCounts,
                            backgroundColor: 'rgba(255, 99, 132, 0.6)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision:0
                            }
                        }
                    }
                }
            });
        }

        downloadReport.addEventListener('click', async function () {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const margin = 15;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            let y = margin + 10;
            const lineHeight = 8;

            // Draw border rectangle
            doc.setDrawColor(117, 75, 162); // purple border color
            doc.setLineWidth(1.5);
            doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);

            // Add multiple small watermark texts diagonally tiled
            doc.setTextColor(200, 200, 200);
            doc.setFontSize(10);
            doc.setFont("helvetica", "italic");
            const watermarkText = "Career Spark";
            const stepX = 80;
            const stepY = 60;
            for (let x = 0; x < pageWidth; x += stepX) {
                for (let yPos = 0; yPos < pageHeight; yPos += stepY) {
                    doc.text(watermarkText, x, yPos, { angle: 45, opacity: 0.05 });
                }
            }
            doc.setTextColor(0, 0, 0);
            doc.setFont("Courier", "normal");
            doc.setFontSize(16);

            doc.text(`Personality Report for ${currentUser.name}`, margin, y);
            y += lineHeight * 2;

            responses.forEach((response, index) => {
                const questionText = `Q${index + 1}: ${response.question}`;
                const answerText = `Answer: ${response.answer}`;
                const reasonText = `Reason: ${response.reason}`;

                const splitQuestion = doc.splitTextToSize(questionText, pageWidth - 2 * margin);
                const splitAnswer = doc.splitTextToSize(answerText, pageWidth - 2 * margin);
                const splitReason = doc.splitTextToSize(reasonText, pageWidth - 2 * margin);

                if (y + (splitQuestion.length + splitAnswer.length + splitReason.length) * lineHeight > pageHeight - margin) {
                    doc.addPage();
                    // Draw border on new page
                    doc.setDrawColor(117, 75, 162);
                    doc.setLineWidth(1.5);
                    doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);
                    // Add tiled watermark on new page
                    doc.setTextColor(200, 200, 200);
                    doc.setFontSize(20);
                    doc.setFont("helvetica", "bold");
                    for (let x = 0; x < pageWidth; x += stepX) {
                        for (let yPos = 0; yPos < pageHeight; yPos += stepY) {
                            doc.text(watermarkText, x, yPos, { angle: 45, opacity: 0.05 });
                        }
                    }
                    doc.setTextColor(0, 0, 0);
                    doc.setFont("Courier", "normal");
                    y = margin + 10;
                }

                doc.text(splitQuestion, margin, y);
                y += lineHeight * splitQuestion.length;
                doc.text(splitAnswer, margin, y);
                y += lineHeight * splitAnswer.length;
                doc.text(splitReason, margin, y);
                y += lineHeight * splitReason.length + lineHeight;
            });

            const remarks = generatePersonalityRemarks(responses);
            const prominentCategory = getProminentCategory();
            const remarksTitle = "--- Personality Remarks:";
            const splitRemarksTitle = doc.splitTextToSize(remarksTitle, pageWidth - 2 * margin);
            const splitRemarks = doc.splitTextToSize(remarks, pageWidth - 2 * margin);
            const categoryTitle = `Most Prominent Category: ${prominentCategory}`;
            const splitCategoryTitle = doc.splitTextToSize(categoryTitle, pageWidth - 2 * margin);

            // Use smaller font size for remarks to fit better
            const remarksFontSize = 12;
            const remarksLineHeight = 7;

            if (y + (splitRemarksTitle.length * remarksLineHeight + splitRemarks.length * remarksLineHeight + splitCategoryTitle.length * remarksLineHeight) + 90 > pageHeight - margin) {
                doc.addPage();
                // Draw border on new page
                doc.setDrawColor(117, 75, 162);
                doc.setLineWidth(1.5);
                doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);
                // Add tiled watermark on new page
                doc.setTextColor(200, 200, 200);
                doc.setFontSize(20);
                doc.setFont("helvetica", "bold");
                for (let x = 0; x < pageWidth; x += stepX) {
                    for (let yPos = 0; yPos < pageHeight; yPos += stepY) {
                        doc.text(watermarkText, x, yPos, { angle: 45, opacity: 0.05 });
                    }
                }
                doc.setTextColor(0, 0, 0);
                doc.setFont("Courier", "normal");
                y = margin + 10;
            }

            doc.setFontSize(remarksFontSize);
            doc.text(splitRemarksTitle, margin, y);
            y += remarksLineHeight * splitRemarksTitle.length;
            doc.text(splitRemarks, margin, y);
            y += remarksLineHeight * splitRemarks.length;
            doc.text(splitCategoryTitle, margin, y);
            y += remarksLineHeight * splitCategoryTitle.length;

            // Reset font size for footer and image
            doc.setFontSize(10);

            // Add footer
            doc.text('Generated by Career Spark', margin, pageHeight - margin + 2);

            // Add chart image below text
            try {
                const canvas = document.getElementById('responseChart');
                if (!canvas) throw new Error('Chart canvas not found');

                // Create a new canvas to scale up the chart for better resolution
                const scaleFactor = 3;
                const scaledCanvas = document.createElement('canvas');
                scaledCanvas.width = canvas.width * scaleFactor;
                scaledCanvas.height = canvas.height * scaleFactor;
                const scaledCtx = scaledCanvas.getContext('2d');
                scaledCtx.scale(scaleFactor, scaleFactor);
                scaledCtx.drawImage(canvas, 0, 0);

                const imgData = scaledCanvas.toDataURL('image/png');

                // Calculate image width and height to fit page width with margin
                const imgProps = doc.getImageProperties(imgData);
                const pdfWidth = pageWidth - 2 * margin;
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                // Add new page if not enough space
                if (y + pdfHeight + 20 > pageHeight) {
                    doc.addPage();
                    // Draw border on new page
                    doc.setDrawColor(117, 75, 162);
                    doc.setLineWidth(1.5);
                    doc.rect(margin / 2, margin / 2, pageWidth - margin, pageHeight - margin);
                    // Add tiled watermark on new page
                    doc.setTextColor(200, 200, 200);
                    doc.setFontSize(20);
                    doc.setFont("helvetica", "bold");
                    for (let x = 0; x < pageWidth; x += stepX) {
                        for (let yPos = 0; yPos < pageHeight; yPos += stepY) {
                            doc.text(watermarkText, x, yPos, { angle: 45, opacity: 0.05 });
                        }
                    }
                    doc.setTextColor(0, 0, 0);
                    y = margin + 10;
                } else {
                    y += 10;
                }
                doc.addImage(imgData, 'PNG', margin, y, pdfWidth, pdfHeight);
            } catch (error) {
                console.error('Error adding chart image to PDF:', error);
            }

            doc.save('personality_report.pdf');
        });

        viewGraphButton.addEventListener('click', () => {
            mainContainer.classList.add('hidden');
            graphPage.classList.remove('hidden');
            drawGraph();
        });

        backToReport.addEventListener('click', () => {
            graphPage.classList.add('hidden');
            mainContainer.classList.remove('hidden');
        });
  </script>
 </body>
</html>
